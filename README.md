# 智慧坐姿偵測系統使用手冊

## 專案簡介

智慧坐姿偵測系統是一套基於**電腦視覺（Computer Vision）**與**姿態估計技術**的即時坐姿監測應用。
系統使用 **MediaPipe** 進行人體關鍵點偵測，透過分析**側面視角**下的**頸部角度**與**軀幹角度**，判斷坐姿是否正確，並提供即時回饋與時間統計功能。

---

## 功能特色

### 核心功能

* **即時坐姿偵測**：以側面視角分析頸部前傾與軀幹傾斜角度
* **視角自動判斷**：自動辨識側面視角進行坐姿判斷
* **即時語音提醒**：坐姿不良持續超過設定時間時，自動播放語音提醒
* **久坐提醒**：連續坐姿達到設定時間（預設 30 分鐘）後播放提醒音效
* **時間統計**：即時統計正確坐姿時間、不良坐姿時間與總坐姿時間
* **設定管理**：支援參數設定的儲存與載入

---

### 偵測指標說明

* **側面頸部門檻值**：偵測頸部前傾角度（預設 50°）
* **側面軀幹門檻值**：偵測軀幹傾斜角度（預設 20°）
* **警示時間門檻**：坐姿異常持續超過此時間即觸發語音提醒（預設 2.0 秒）
* **久坐提醒時間**：連續坐姿累積達此時間即播放提醒（預設 60 分鐘）

---

## 環境需求

### 系統需求

* **作業系統**：Windows 10 / 11、Linux、macOS
* **Python 版本**：Python 3.8 以上
* **攝影設備**：支援 USB 攝影機或影片檔案輸入

---

### 相依套件

```txt
PyQt5 >= 5.15.0
opencv-python >= 4.5.0
mediapipe >= 0.10.0
pygame >= 2.0.0
pyttsx3 >= 2.90
numpy >= 1.19.0
```

### 安裝套件

```bash
pip install PyQt5 opencv-python mediapipe pygame pyttsx3 numpy
```

---

## 快速開始

### 1. 啟動程式

```bash
python main.py
```

---

### 2. 選擇輸入來源

* **攝影機**：選擇「攝影機 Camera」（預設）
* **影片檔案**：選擇「影片檔案 Video File」，並點擊「瀏覽」選擇影片

---

### 3. 參數設定（選用）

可於右側「參數設定」區域調整：

* **解析度**：影響畫面品質與系統效能
* **偵測頻率**：設定每 N 影格偵測一次（1 代表每影格偵測）
* **側面頸部門檻值**：頸部前傾角度上限（度）
* **側面軀幹門檻值**：軀幹傾斜角度上限（度）
* **警示時間門檻**：異常持續時間（秒）
* **久坐提醒（分鐘）**：久坐提醒時間（分鐘）

---

### 4. 開始偵測

點擊「開始偵測 Start」按鈕，即可啟動系統。

---

### 5. 查看結果

* **即時狀態**：顯示目前坐姿狀態（正確／不良）與角度資訊
* **統計結果**：顯示累積的正確坐姿時間、不良坐姿時間與總坐姿時間

---

## 介面說明

### 主畫面配置

* **左側**

  * 影像顯示區
  * 輸入來源選擇
* **右側**

  * 參數設定
  * 即時狀態
  * 統計結果
  * 使用提示

---

### 狀態顯示說明

* **綠色（✓ 坐姿正確）**：目前坐姿符合設定標準
* **紅色（✗ 坐姿不良）**：坐姿需調整
* **灰色（正面視角）**：偵測到正面視角，系統不進行坐姿判斷

---

### 角度資訊說明

* **頸部角度**：顯示目前頸部前傾角度與門檻值
* **軀幹角度**：顯示目前軀幹傾斜角度與門檻值
* 角度數值小於門檻值表示坐姿正確

---

## 設定管理

### 儲存設定

1. 調整參數後，點擊「儲存設定」
2. 系統會將設定存至 `config.txt`

### 載入設定

1. 點擊「載入設定」
2. 系統將讀取 `config.txt`
3. 若檔案不存在，將套用預設設定

---

### 設定檔格式

```txt
side_neck_threshold=50
side_torso_threshold=20
warning_time=2.0
sitting_minutes=30
resolution=640x480
skip_frames=1
```

---

## 使用建議

### 建議攝影角度

* **建議**：側面視角（肩膀距離小於 100 像素）
* **不建議**：正面視角（僅用於視角判斷，不進行坐姿分析）

---

### 坐姿判定標準

* **頸部角度**：小於設定門檻（預設 50°）
* **軀幹角度**：小於設定門檻（預設 20°）

---

### 效能最佳化建議

* **效能較低設備**

  * 降低解析度（320×240 或 480×360）
  * 提高偵測間隔（例如每 4 影格偵測一次）
* **效能較高設備**

  * 提高解析度（1280×720）
  * 每影格偵測（偵測頻率 = 1）

---

### 參數調整建議

* **過於敏感**：提高角度門檻值
* **不夠靈敏**：降低角度門檻值
* **頻繁提醒**：延長警示時間門檻（例如 3 秒以上）

---

## 問題排除（Troubleshooting）

### 常見問題

**Q：攝影機無法啟動**

* 確認攝影機未被其他程式佔用
* 嘗試重新啟動程式或重新插拔攝影機
* 檢查驅動程式是否正常

---

**Q：無法偵測到人體**

* 確認攝影機角度正確（側面最佳）
* 確保環境光線充足
* 調整攝影機位置，使上半身完整入鏡

---

**Q：語音提醒未播放**

* 檢查系統音量
* 確認 `output.wav` 與 `output2.wav` 存在於程式目錄
* 確認有可用的音訊輸出裝置

---

**Q：偵測結果不準確**

* 調整角度門檻值
* 固定攝影機位置，避免晃動
* 避免強光或陰影干擾

---

**Q：程式執行卡頓**

* 降低解析度
* 提高偵測間隔（N > 1）
* 關閉其他高資源占用程式

---

### 音訊檔案說明

* **output.wav**：坐姿不良提醒音效
* **output2.wav**：久坐提醒音效
* 若檔案不存在，系統將嘗試自動產生預設音效

---

## 注意事項

1. **隱私保護**：系統僅於本機端運作，不會上傳任何影像或資料
2. **偵測限制**：僅支援側面視角坐姿判斷
3. **無人狀態處理**：連續 10 次未偵測到人體，久坐計時將自動重置
4. **設定保存**：參數修改後需手動點擊「儲存設定」才會寫入檔案

---

## 技術架構

* **使用者介面**：PyQt5
* **影像處理**：OpenCV
* **姿態估計**：MediaPipe
* **音訊播放**：Pygame
